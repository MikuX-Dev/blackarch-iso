  stages:
    - build

  build:
    stage: build
    <<: *REGULAR_TASK_TEMPLATE
    container: 
      image: mikuxdev/archiso-builder:latest
      privileged: true
      accel_check_script: emulator -accel-check
      cpu: 4
      memory: 4G      
    script:
      - sh -c "curl https://archlinux.org/mirrorlist/\?country=all\&protocol=http\&protocol=https\&ip_version=4\&ip_version=6\&use_mirror_status=on -o /etc/pacman.d/mirrorlist && sed -i 's/#S/S/g' /etc/pacman.d/mirrorlist"
      - pacman -Syyu --noconfirm --quiet 
      - git clone https://github.com/MikuX-Dev/blackarch-iso
      - mkdir -p work out
      - mkarchiso -v -r -w work -o out blackarch-iso/slim-iso
      - cirrus upload out/*.iso --name "Blackarch-slim-iso"
